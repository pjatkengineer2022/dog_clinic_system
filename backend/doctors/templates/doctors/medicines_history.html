{% extends 'base_doctor.html' %}
{% block content %}
<section 
    class="c__intro" 
    style="background-image: url('../../assets/img/medicines_bg.jpg');">
    <div class="intro__content">
        <h1 class="intro__title animated fadeInDown">Pacjent - Historia leków</h1>
    </div>
</section>
<section class="s__medicines-history">
    <div class="l-container-big">
        <div class="g__head"></div>
        <div class="g__patient-intro">
            <div class="g__patient-photo-wrapper">
                <div class="g__avatar-box patient__photo-box">
                    <img src="{{pet.avatar.url}}" alt="avatar" class="g__avatar-img-no-photo dog__img-no-photo">
                </div>
            </div>
            <div class="g__patient-text-wrapper">
                <div class="g__patient-text-row">
                    <span class="g__patient-text-label">Imię:</span>
                    <span class="g__patient-text-value">{{pet.name}}</span>
                </div>
                <div class="g__patient-text-row">
                    <span class="g__patient-text-label">Rasa:</span>
                    {% if pet.race %}
                    <span class="g__patient-text-value">{{pet.race}}</span>
                    {% else %}
                    <span class="g__patient-text-value">---------------</span>
                    {% endif %}
                </div>
                <div class="g__patient-text-row">
                    <span class="g__patient-text-label">Rok urodzenia:</span>
                    {% if pet.year_birth %}
                    <span class="g__patient-text-value">{{pet.year_birth}}</span>
                    {% else %}
                    <span class="g__patient-text-value">---------------</span>
                    {% endif %}
                </div>
                <div class="g__patient-text-row">
                    <span class="g__patient-text-label">Właściciel:</span>
                    {% if pet.owner.profile.name %}
                    <span class="g__patient-text-value">{{pet.owner.profile.name}}</span>
                    {% else %}
                    <span class="g__patient-text-value">{{pet.owner.profile.user.username}}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% include "searching.html" with url_variable='medicines_history' url_variable_id=pet.id my_placeholder="Wyszukaj lek..." %}
        <div class="visits__container">
            <ul class="visit__list">
                {% for medicinehistory in medicine_histories %}
                    <li class="g__row-box">
                        <h2 class="g__row-box-header">
                            {{medicinehistory.medicine.name}} - producent: {{medicinehistory.medicine.producer.name}}
                        </h2>
                        <div class="g__row-box-content is-multiline columns">
                            <div class="g__row-box-column column is-2-desktop is-full-touch">
                                <div class="g__row-box-subheader">
                                    Start terapii:
                                </div>
                                <div class="g__row-box-desc">
                                    {{medicinehistory.treatment.start|date:'Y-m-d'}}
                                </div>
                            </div>
                            <div class="g__row-box-column column is-4-desktop is-full-touch">
                                <div class="g__row-box-subheader">
                                    Opis leku:
                                </div>
                                <div class="g__row-box-desc">
                                    {{medicinehistory.medicine.description}}
                                </div>
                            </div>
                            <div class="g__row-box-column column is-2-desktop is-full-touch">
                                <div class="g__row-box-subheader">
                                    Choroba:
                                </div>
                                <div class="g__row-box-desc">
                                    {{medicinehistory.treatment.disease.name}}
                                </div>
                            </div>
                            <div class="g__row-box-column column is-4-desktop is-full-touch">
                                <div class="g__row-box-subheader">
                                    Diagnozy do choroby:
                                </div>
                                <div class="g__row-box-desc">
                                    {% if medicinehistory.treatment.diagnosis_set.all%}
                                        {% for diagnosis in medicinehistory.treatment.diagnosis_set.all %}
                                            <p>{{diagnosis.visit.date.date }} : {{ diagnosis.description }}</p>
                                        {% endfor %}
                                    {% else %}
                                        ------------------
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
                {% if medicine_histories.has_previous or medicine_histories.has_next %}
                    {% if medicine_histories.has_previous %}
                        <a href="?page=1">First</a>
                        <a href="?page={{ medicine_histories.previous_page_number }}">Previous</a>
                    {% endif %}
                    {% for num in medicine_histories.paginator.page_range %}
                        {% if medicine_histories.number == num %}
                            <a href="?page={{ num }}">{{ num }}</a>
                        {% elif num > medicine_histories.number|add:'-3' and num < medicine_histories.number|add:'3' %}
                            <a href="?page={{ num }}">{{ num }}</a>
                        {% endif %}
                    {% endfor %}
                    {% if medicine_histories.has_next %}
                        <a href="?page={{ medicine_histories.next_page_number }}">Next</a>
                        <a href="?page={{ medicine_histories.paginator.num_pages}}">Last</a>
                    {% endif %}
                {% endif %}
            </ul>
        </div>
    </div>
</section>
<section 
    class="c__parallax" 
    style="background-image: url('../../assets/img/parallax7.jpg');">
</section>
{% endblock content %}